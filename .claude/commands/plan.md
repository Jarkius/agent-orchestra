---
description: "Create implementation plans with real context. Output to file or GitHub issue."
---

# Plan

Create structured implementation plans with gathered context.

## Usage

```
/plan <feature description>
/plan <feature description> --issue
```

## Examples

```bash
# Create plan file (default)
/plan Add knowledge graph support for learnings

# Create GitHub issue instead
/plan Add knowledge graph support for learnings --issue
```

## Instructions

### Step 1: Parse Arguments

Extract the feature description and check for `--issue` flag from: `$ARGUMENTS`

### Step 2: Gather Context

Run these commands to gather real context:

```bash
# Recent commits (last 5)
git log --format="- \`%h\` %s" -5

# Current branch
git branch --show-current

# Check if gh is available
which gh >/dev/null 2>&1 && echo "GitHub CLI available"

# Recent issues (if gh available)
gh issue list --limit 5 --state open --json number,title 2>/dev/null | jq -r '.[] | "- #\(.number) \(.title)"' || echo "No GitHub access"
```

Search for related files using the feature keywords:
- Use Grep to find related code
- Use Glob to find related docs

### Step 3: Create Plan

Generate a structured plan with this format:

```markdown
# Plan: [Feature Name]

**Created**: [date] [time]
**Branch**: [current branch]

## Context

Recent commits:
- `abc123` Commit message
- `def456` Another commit

Related files:
- `path/to/file.ts` - Why it's relevant

## Problem

[What needs to be solved - be specific]

## Solution

[Concrete approach to solve it]

## Implementation Steps

1. [ ] First step
2. [ ] Second step
3. [ ] Third step

## Files to Modify

| File | Changes |
|------|---------|
| `path/file.ts` | What changes |

## Verification

- [ ] How to test this works

---
*Generated by /plan command*
```

### Step 4: Output

**If `--issue` flag and gh available:**
```bash
gh issue create \
  --title "plan: [Feature Name]" \
  --body "[plan content]" \
  --label "plan"
```

**Otherwise (default):**
```bash
mkdir -p plans
# Write to plans/YYYY-MM-DD_feature-slug.md
```

### Step 5: Report

```
âœ… Plan created!

Feature: [name]
Output: plans/2026-01-19_feature-name.md (or Issue #N URL)
Steps: N defined
Context: M commits, K files referenced
```

## Output Format

The plan file should be actionable:
- Clear problem statement
- Concrete solution (not vague)
- Checkboxes for steps (can be copied to todo)
- Specific files with specific changes

## Notes

- Plans go to `plans/` directory (not `.claude/plans/` which is for plan mode)
- GitHub issues get the `plan` label
- Always gather real context, don't make up commits/files
- Keep steps concrete and actionable
