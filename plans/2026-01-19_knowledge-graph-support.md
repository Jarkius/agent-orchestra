# Plan: Add Knowledge Graph Support for Learnings

**Created**: 2026-01-19 16:35
**Completed**: 2026-01-19 16:50
**Branch**: main
**Status**: ✅ FULLY IMPLEMENTED

## Context

Recent commits:
- `960de48` Add source_url field for external references in learnings
- `81edd03` Update docs with recent memory command additions
- `ad8cbc5` Remove slash from /clear in memory-save description
- `4320973` Lower statusline warning thresholds for earlier alerts
- `4684375` Add --duplicates flag to purge command

Open issues:
- #5 Fix TypeScript strict mode errors
- #4 Implement auto-merge workflow for completed tasks
- #1 Implement learning feedback loop

Related files:
- `src/db.ts` - Already has learning_links table for relationships
- `src/vector-db.ts` - ChromaDB for semantic search
- `src/services/recall-service.ts` - Memory recall logic

Related learning:
- #404 "Knowledge graphs enable relational queries beyond similarity" (architecture, low confidence)

## Problem

Current memory system uses vector similarity for finding related content. This misses explicit relationships between concepts. For example:
- "MemGPT uses hierarchical memory" - relationship between MemGPT and hierarchy
- "Knowledge graphs relate to entity extraction" - concept dependency
- Learning #404 relates to Learning #407 through "memory architecture" concept

Vector search finds similar text but can't answer: "What concepts relate to X through Y?"

## Solution

Add entity extraction and relationship tracking alongside existing vector embeddings:

1. **Entity extraction** - Extract key concepts/entities from learnings
2. **Relationship table** - Store entity relationships (entity → relation → entity)
3. **Graph queries** - Enable queries like "what relates to X?" or "path from A to B"
4. **Hybrid retrieval** - Combine vector similarity + graph traversal

## Implementation Steps

1. [x] Create `entities` table (id, name, type, learning_id)
2. [x] Create `learning_entities` junction table (many-to-many relationship)
3. [x] Add entity extraction on learning save (keyword extraction)
4. [x] Add `getRelatedEntities(entityName)` function
5. [x] Add `findEntityPath(entityA, entityB)` for relationship traversal
6. [x] Update recall to show entity relationships
7. [x] Add `/memory-graph` command to visualize relationships

## Files to Modify

| File | Changes |
|------|---------|
| `src/db.ts` | Add entities and entity_relationships tables, CRUD functions |
| `scripts/memory/learn.ts` | Extract entities on save |
| `scripts/memory/recall.ts` | Show related entities in output |
| `.claude/commands/memory-graph.md` | New command to explore graph |

## Verification

- [x] Create learning with entities → entities extracted
- [x] Query `getRelatedEntities("memory")` → returns related concepts
- [x] Recall shows "Entities: X, Y, Z"
- [x] `/memory-graph memory` shows relationship visualization

## Future Enhancements

- LLM-based entity extraction (more accurate than keywords)
- Relationship type inference
- Graph visualization (mermaid diagrams)
- Cross-session entity linking

---
*Generated by /plan command*
